<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Brew Bliss - Welcome</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />


  <style>
    .font_1 { font-size: 24px; }
    .font_2 { font-size: 20px; }
    .font_3 { font-size: 16px; }

    /* Basic styling for validation messages - you can enhance this with your style.css */
    input:invalid:not(:placeholder-shown) {
        border: 2px solid red;
    }
    /* Updated selector for validation messages - ensure this matches your actual setup */
    input:invalid:not(:placeholder-shown) + .validation-message,
    input:invalid:not(:placeholder-shown) ~ .validation-message { /* Added ~ for siblings */
        display: block;
        color: red;
        font-size: 0.8em;
        margin-top: 5px;
    }
    .validation-message { /* Added a class for the message span */
        display: none;
    }
  </style>
  <script>
    function ChangeFont(fontClass) {
      document.body.className = fontClass;
    }
  </script>
</head>
<body>
  <nav id="nav">
    <div class="navTop">
      <div class="navItem">
        <img src="images/Contact/logo.png" alt="logo" class="logo">
      </div>


      <div class="navItem">
            <a class="btn" href="index.html">Home</a>
            
            <a class="btn" href="search.html">Search</a>
            <a class="btn" href="#products">Menu</a>
        </div>
 
        <div></div><div></div><div></div>
     
      <div class="navItem navLinks">
        <a class="btn" href="login.html">Login</a>
          <a class="btn1" href="register.html">Register</a>
      </div>
    </div>
  </nav>


  <main>
        <section id="intro">
          <section class="intro">
            <h2>Your Daily Cup of Joy</h2>
            <p>We serve love, warmth, and great coffee.</p>
          </section>
        </section>
       
      </main>


  <section id="products">
    <h2>Menu</h2><br>


    <section id="drinks">
      <h2>Drinks</h2>
      <div class="product-grid" id="drinksGrid"></div>
    </section>


    <section id="foods">
      <br><h2>Desserts</h2>
      <div class="product-grid" id="foodGrid"></div>
    </section>


    <button id="cartToggle" onclick="toggleCart()">View Cart</button>


    <div id="cart" style="display: none;">
      <h3>Your Cart:</h3><br>
      <div id="cartItems"></div>
      <strong>Total: RM <span id="total">0.00</span></strong>
      <button id="buyNow" onclick="buyNow()">Buy Now</button>
    </div>
  </section>


  <div id="paymentModal" style="display: none;">
    <div class="payment">
      <span class="close" onclick="document.getElementById('paymentModal').style.display='none'">X</span>
      <br>
      
      <h1 class="payTitle">Personal Information</h1>
      <form action="index.php" method="POST" id="paymentForm"> <!-- Changed action to index.php for combined file -->
        <input type="hidden" name="cart" id="cartInput">


        <div class="personal-info-section">
    <div class="form-group">
        <label for="name"><strong>Name and Surname</strong></label>
        <input type="text" name="username" placeholder="Enter your name" class="payInput" required>
    </div>
    <div class="form-group">
        <label for="phone"><strong>Phone Number</strong></label>
        <input type="text" name="phone" placeholder="+60 12-345 6789" class="payInput" required>
    </div>
    <div class="form-group">
        <label for="address"><strong>Address</strong></label>
        <input type="text" name="address" placeholder="Your address" class="payInput" required><br><br>
    </div>
    <div class="form-group">
        <label for="remark"><strong>Remark</strong></label>
        <input type="text" name="remark" placeholder="Remarks" class="payInput" ><br><br>
    </div>
</div>

        <h1 class="payTitle">Card Information</h1>
        <div class="cardIcons">
          <img src="./images/Contact/visa.png" width="40" class="cardIcon">
          <img src="./images/Contact/master.png" width="40" class="cardIcon">
        </div>


        <input type="text" name="card_number" class="payInput" placeholder="Card Number" required
               pattern="^(\d{4}\s*){3}\d{1,4}$|^\d{13,16}$"
               title="Card number must be 13-16 digits with or without spaces"
               id="cardNumberInput" maxlength="19">
        <div class="cardInfo">
          <input type="text" name="expiry_month" placeholder="mm" class="payInput sm" required
                 pattern="^(0?[1-9]|1[0-2])$" title="Month must be between 01 and 12 (e.g., 03 or 12)"
                 id="expiryMonthInput" maxlength="2">
          <input type="text" name="expiry_year" placeholder="yyyy" class="payInput sm" required
                 pattern="^\d{4}$" title="Year must be a 4-digit number"
                 id="expiryYearInput" maxlength="4">
          <input type="text" name="cvv" placeholder="cvv" class="payInput sm" required
                 pattern="^\d{3,4}$" title="CVV must be 3 or 4 digits"
                 id="cvvInput" maxlength="4">
        </div>

<br><br>
        <button type="submit" class="payButton">Checkout!</button>
      </form>
    </div>
  </div>


<script>
  const products = [
    { name: "Espresso", image: "Drinks/espresso.jpg", price: 6.00, type: "drink", description: "Strong and bold espresso" },
    { name: "Latte", image: "Drinks/latte.jpg", price: 8.50, type: "drink", description: "Smooth milk latte" },
    { name: "Americano", image: "Drinks/americano.jpg", price: 7.00, type: "drink", description: "Espresso with hot water" },
    { name: "Cappuccino", image: "Drinks/cappuccino.jpg", price: 8.00, type: "drink", description: "Classic cappuccino with foam" },
    { name: "Mocha", image: "Drinks/mocha.jpg", price: 9.00, type: "drink", description: "Chocolate flavored coffee" },
    { name: "Apple Juice", image: "Drinks/apple.jpg", price: 5.50, type: "drink", description: "Fresh apple juice" },
    { name: "Orange Juice", image: "Drinks/orange.jpg", price: 5.50, type: "drink", description: "Fresh orange juice" },
    { name: "Watermelon Juice", image: "Drinks/watermelon.jpg", price: 6.00, type: "drink", description: "Refreshing watermelon juice" },
    { name: "Honey Lemon", image: "Drinks/honeylemon.jpg", price: 5.00, type: "drink", description: "Sweet and tangy honey lemon" },
    { name: "Lemon Tea", image: "Drinks/lemontea.jpg", price: 5.00, type: "drink", description: "Cool lemon-flavored tea" },
    { name: "Caramel Milkshake", image: "Drinks/milkshake.jpg", price: 8.00, type: "drink", description: "smooth caramel milkshake" },
    { name: "Matcha", image: "Drinks/matcha.jpg", price: 9.00, type: "drink", description: "A creamy drink made by matcha powder and milk" },
    { name: "Strawberry Cake", image: "food/strawberryCake.jpg", price: 12.00, type: "food", description: "Sweet strawberry cake" },
    { name: "Red Velvet", image: "food/redVelvet.jpg", price: 13.00, type: "food", description: "Rich red velvet cake" },
    { name: "Brownie", image: "food/brownie.jpg", price: 6.50, type: "food", description: "Chocolate brownie" },
    { name: "Chocolate Cake", image: "food/chocolateCake.jpg", price: 12.00, type: "food", description: "Delicious chocolate cake" },
    { name: "Chocolate Cupcake", image: "food/chocolateCupcake.jpg", price: 6.00, type: "food", description: "Moist chocolate cupcake" },
    { name: "Vanilla Cupcake", image: "food/vanillaCupcake.jpg", price: 6.00, type: "food", description: "Vanilla flavored cupcake" },
    { name: "Tiramisu", image: "food/tiramisu.jpg", price: 14.00, type: "food", description: "Classic tiramisu dessert" },
    { name: "Berry Cheesecake", image: "food/berriesCheesecake.jpg", price: 13.50, type: "food", description: "Cheesecake with berries" },
    { name: "Mango Cheesecake", image: "food/mangoCheesecake.jpg", price: 13.50, type: "food", description: "Mango cheesecake slice" },
    { name: "Pancake", image: "food/pancake.jpg", price: 7.50, type: "food", description: "Stack of fluffy pancakes" },
    { name: "Chocolate Mousse", image: "food/chocolateMousse.jpg", price: 9.00, type: "food", description: "Creamy chocolate mousse" }
  ];

  const drinksGrid = document.getElementById("drinksGrid");
  const foodGrid = document.getElementById("foodGrid");
  let cart = JSON.parse(localStorage.getItem("cart")) || [];

  // Display all products
  products.forEach(p => {
    const div = document.createElement("div");
    div.className = "product";
    const imageLink = `<a href="search.html?type=${p.type}"><img src="images/${p.image}" alt="${p.name}"></a>`;

    if (p.type === "drink") {
      div.innerHTML = `
        ${imageLink}
        <h4>${p.name}</h4>
        <label>Hot/Ice:</label>
        <select id="temp-${p.name}">
          <option value="Hot">Hot</option>
          <option value="Ice">Ice</option>
        </select>
        <p>${p.description}</p>
        <p>RM ${p.price.toFixed(2)}</p>
        <button onclick="addToCart('${p.name}', ${p.price}, document.getElementById('temp-${p.name}').value)">Add to Cart</button>
      `;
      drinksGrid.appendChild(div);
    } else {
      div.innerHTML = `
        ${imageLink}
        <h4>${p.name}</h4>
        <p>${p.description}</p>
        <p>RM ${p.price.toFixed(2)}</p>
        <button onclick="addToCart('${p.name}', ${p.price})">Add to Cart</button>
      `;
      foodGrid.appendChild(div);
    }
  });

  // Add item to cart
  function addToCart(name, price, temp = null) {
    const itemKey = temp ? `${name} (${temp})` : name;
    const item = cart.find(i => i.name === itemKey);
    if (item) {
      item.qty++;
    } else {
      cart.push({ name: itemKey, price, qty: 1 });
    }
    saveCart();
    renderCart();
    openCart();
  }

  // Decrease quantity
  function decreaseQty(name) {
    const item = cart.find(i => i.name === name);
    if (item) {
      item.qty--;
      if (item.qty <= 0) {
        cart = cart.filter(i => i.name !== name);
      }
    }
    saveCart();
    renderCart();
  }

  // Remove item completely
  function removeFromCart(name) {
    cart = cart.filter(i => i.name !== name);
    saveCart();
    renderCart();
  }

  // Save cart to localStorage
  function saveCart() {
    localStorage.setItem("cart", JSON.stringify(cart));
  }

  // Render cart visually
  function renderCart() {
    const cartItems = document.getElementById("cartItems");
    const totalEl = document.getElementById("total");
    cartItems.innerHTML = "";
    let total = 0;

    cart.forEach(item => {
      const [pureName, temp] = item.name.includes("(")
        ? item.name.replace(")", "").split(" (")
        : [item.name, null];

      const product = products.find(p => p.name === pureName);
      const imgSrc = product ? `images/${product.image}` : "images/placeholder.jpg";

      const itemDiv = document.createElement("div");
      itemDiv.className = "cart-item";
      itemDiv.innerHTML = `
        <img src="${imgSrc}" alt="${pureName}" class="cart-img">
        <div class="cart-info">
          <p class="cart-name">${pureName}${temp ? ` (${temp})` : ""}</p>
          <div class="cart-controls">
            <button class="qty-btn" onclick="decreaseQty('${item.name}')">‚àí</button>
            <input type="number" class="cart-qty-input" value="${item.qty}" min="1" data-name="${item.name}">
            <button class="qty-btn" onclick="addToCart('${pureName}', ${item.price}, '${temp || ""}')">+</button>
            <p class="cart-price"><label>RM ${(item.price * item.qty).toFixed(2)}</label></p>
          </div>
          
        </div>
        <label for="action"><button class="trash-btn" onclick="removeFromCart('${item.name}')">üóëÔ∏è</button></label>
      `;
      cartItems.appendChild(itemDiv);
      total += item.price * item.qty;
    });

    totalEl.textContent = total.toFixed(2);
  }

  // Handle manual quantity input
  document.addEventListener("input", (e) => {
    if (e.target.classList.contains("cart-qty-input")) {
      const name = e.target.dataset.name;
      const newQty = parseInt(e.target.value);
      const item = cart.find(i => i.name === name);
      if (item && newQty > 0) {
        item.qty = newQty;
      } else if (newQty <= 0) {
        removeFromCart(name);
      }
      saveCart();
      renderCart();
    }
  });

  // Toggle cart display
  function toggleCart() {
    const cartEl = document.getElementById("cart");
    cartEl.style.display = cartEl.style.display === "none" ? "block" : "none";
  }

  function openCart() {
    document.getElementById("cart").style.display = "block";
  }

  // Function to prepare cart data and clean card number for submission
  function prepareFormForSubmission() {
    document.getElementById('cartInput').value = JSON.stringify(cart);

    // Clean card number by removing spaces before submission
    const cardNumberInput = document.getElementById('cardNumberInput');
    // Store original formatted value temporarily if you want to restore it later
    const originalCardNumberValue = cardNumberInput.value;
    cardNumberInput.value = cardNumberInput.value.replace(/\s/g, ''); // Remove all spaces

    // Make sure phone number is also cleaned if you are only storing digits in DB
    const phoneInput = document.querySelector('input[name="phone"]');
    // Store original formatted value temporarily
    const originalPhoneValue = phoneInput.value;
    phoneInput.value = phoneInput.value.replace(/[^0-9]/g, ''); // Remove non-digits from phone

    // You might want to store these original values in a hidden field or global var
    // if the form could fail validation on the server and you want the user to see their formatted input again.
    // For this example, we're just cleaning for immediate submission.
  }

  function buyNow() {
    if (cart.length === 0) {
      alert("Your cart is empty!");
      return;
    } else {
      // Open the payment modal
      document.getElementById('paymentModal').style.display = "flex";
      // The actual preparation and cleaning will happen on form submit
    }
  }

  // --- Payment Modal Validation and Formatting Logic ---
  const cardNumberInput = document.getElementById('cardNumberInput');
  const expiryMonthInput = document.getElementById('expiryMonthInput');
  const expiryYearInput = document.getElementById('expiryYearInput');
  const cvvInput = document.getElementById('cvvInput');
  const phoneInput = document.querySelector('input[name="phone"]'); // Get phone input


  const currentYear = new Date().getFullYear();
  const maxExpiryYear = currentYear + 10; // Calculate the maximum allowed year for expiry

  // Add event listener to the form to call prepareFormForSubmission before actual submit
  const paymentForm = document.getElementById('paymentForm');
  if (paymentForm) {
      paymentForm.addEventListener('submit', function(event) {
          // IMPORTANT: Call prepareFormForSubmission() HERE.
          // This will clean the card number and phone number inputs' values just before the form is sent.
          prepareFormForSubmission();
          // The browser will then proceed with its native validation (patterns, required, etc.)
          // and if valid, send the form.
      });
  }


  // 1. Card Number Formatting (add spaces every 4 digits)
  cardNumberInput.addEventListener('input', function(event) {
    let value = this.value.replace(/\D/g, ''); // Remove non-digits
    value = value.replace(/(\d{4})(?=\d)/g, '$1 '); // Add space after every 4 digits
    this.value = value;
  });

  // 2. Expiry Month Formatting (ensure 2 digits and validation)
  expiryMonthInput.addEventListener('input', function() {
    let month = this.value.replace(/\D/g, ''); // Remove non-digits
    if (month.length > 2) { // Limit to 2 digits
        month = month.substring(0, 2);
    }
    this.value = month;

    let monthInt = parseInt(month);
    if (isNaN(monthInt) || monthInt < 1 || monthInt > 12) {
      this.setCustomValidity('Month must be between 1 and 12');
    } else {
      this.setCustomValidity('');
    }
  });

  // 3. Expiry Year Formatting and Validation
  expiryYearInput.addEventListener('input', function() {
    let year = this.value.replace(/\D/g, ''); // Remove non-digits
    if (year.length > 4) { // Limit to 4 digits
        year = year.substring(0, 4);
    }
    this.value = year;

    let yearInt = parseInt(year);
    // Modified validation: must be >= currentYear AND <= currentYear + 10
    if (isNaN(yearInt) || yearInt < currentYear || yearInt > maxExpiryYear) {
      this.setCustomValidity(`Year must be between ${currentYear} and ${maxExpiryYear}`);
    } else {
      this.setCustomValidity('');
    }
  });

  // 4. CVV Formatting (ensure 3-4 digits)
  cvvInput.addEventListener('input', function() {
    let cvv = this.value.replace(/\D/g, ''); // Remove non-digits
    if (cvv.length > 4) { // Limit to 4 digits
        cvv = cvv.substring(0, 4);
    }
    this.value = cvv;
     // Pattern attribute will handle exact 3-4 digit validation on submit
  });

  // 5. Phone number formatting (allow +, numbers, spaces, hyphens for display, but clean for submission)
  phoneInput.addEventListener('input', function() {
      // Basic formatting for display - keeps digits, +, -, spaces
      // You can make this more sophisticated if needed for specific phone number formats
      this.value = this.value.replace(/[^0-9+\s-]/g, '');
  });


  // Prevent non-numeric input for all relevant fields (allow space for card number, + - for phone)
  const allNumericLikeInputs = document.querySelectorAll('#cardNumberInput, #expiryMonthInput, #expiryYearInput, #cvvInput, input[name="phone"]');
  allNumericLikeInputs.forEach(input => {
    input.addEventListener('keypress', function(event) {
      // Allow digits by default
      if (/\d/.test(event.key)) {
        return;
      }
      // Allow space for card number input only
      if (input.id === 'cardNumberInput' && event.key === ' ') {
        return;
      }
      // Allow '+' and '-' for phone number input only
      if (input.name === 'phone' && (event.key === '+' || event.key === '-')) {
          return;
      }
      // Prevent all other non-digit keys
      event.preventDefault();
    });
  });

  // On load, render saved cart
  renderCart();
  if (cart.length > 0) openCart();
</script>




<footer>
  <div class="footerLeft">
      <div class="footerMenu">
          <h1 class="fMenuTitle">About Us</h1>
          <ul class="fList">
              <li class="fListItem"><strong>Opening hour</strong><br>
              every day from 8:00 AM to 9:00 PM</li>
              <li class="fListItem"><strong>Location</strong><br>
              10 Downing Street, London SW1A 1AA</li>
              <li class="fListItem"><strong>Contact number</strong><br>
              +60123456789</li>
              <li class="fListItem"><strong>Email</strong><br>
              brewbliss@gmail.com</li>
          </ul>
      </div>
<div class="footerMenu">
          <div>
        <h1 class="fMenuTitle">Text Size</h1>
              <div>
                <a class="font_1" onclick="javascript:ChangeFont('font_1');" href="javascript:void(0);">Aa</a>
                <a class="font_2" onclick="javascript:ChangeFont('font_2');" href="javascript:void(0);">Aa</a>
                <a class="font_3" onclick="javascript:ChangeFont('font_3');" href="javascript:void(0);">Aa</a>
              </div>


          </div>
        </div>
  </div>
  <div class="footerRight">
      <div class="footerRightMenu">
          <h1 class="fMenuTitle">Subscribe to our channel</h1>
      </div>
      <div class="footerRightMenu">
          <h1 class="fMenuTitle">Follow Us</h1>
          <div class="fIcons">
              <img src="./images/Contact/facebook.png"  alt="facebook" class="fIcon">
              <img src="./images/Contact/instagram.png" alt="instagram" class="fIcon">
              <img src="./images/Contact/whatsapp.png" alt="whatsapp" class="fIcon">
          </div>
      </div>
      <div class="footerRightMenu">
          <span class="copyright">¬© 2025 Brew Bliss. All rights reserved.</span>
      </div>
  </div>
</footer>
</body>
</html>
