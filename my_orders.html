<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My Orders - Brew Bliss</title>
  <link rel="stylesheet" href="style.css" />
  <style>
        /* General body font size for different classes */
        .font_1 body { font-size: 24px; }
        .font_2 body { font-size: 20px; }
        .font_3 body { font-size: 16px; }
    </style>
</head>
<body>
  <nav id="nav">
      <div class="navTop">
        <div class="navItem">
          <img src="images/Contact/logo.png" alt="Brew Bliss Logo" class="logo">
        </div>
        <div class="navItem navLinks">
          <a class="btn" href="index.html">Home</a>
          <a class="btn" href="my_orders.html">View Other Orders</a> <!-- Option to go back to input form -->
          <!-- No logout as the user isn't conventionally logged in via session -->
        </div>
      </div>
  </nav>
<br>
<main class="dashboard_main">
  <header>
    <h1>My Order History</h1>
  </header> <br><br><br>
  <section class="order_table">
    <h2>Your Past Orders</h2>
    <table>
      <thead>
        <tr>
        <th>Order ID</th>
        <th>Product Name</th>
        <th>Quantity</th>
        <th>Price</th>
        <th>Purchase Time</th>
      </tr>
      </thead>
      <tbody id="order_items">
        <!-- Order data will be loaded here by JavaScript -->
      </tbody>
    </table>
    <p id="no_orders_message" style="display: none; text-align: center; margin-top: 20px;">You haven't placed any orders yet.</p>
  </section>
  <br>
</main>
  <script>
    // Function to change the body's font size based on the selected class
    function ChangeFont(fontClass) {
        document.body.classList.remove('font_1', 'font_2', 'font_3');
        document.body.classList.add(fontClass);
    }

    function displayOrders() {
        const noOrdersMessage = document.getElementById('no_orders_message');
        const orderTbody = document.getElementById('order_items');

        if (!orderTbody) {
            console.error("Error: 'order_items' tbody not found!");
            noOrdersMessage.textContent = "Error loading orders display.";
            noOrdersMessage.style.display = 'block';
            return;
        }

        orderTbody.innerHTML = ''; // Clear existing content
        noOrdersMessage.style.display = 'none'; // Hide message initially

        const storedOrders = sessionStorage.getItem('customerOrders');

        if (storedOrders) {
            const data = JSON.parse(storedOrders);

            if (data.length > 0) {
                // Group items by order ID for better display
                const ordersMap = new Map();
                data.forEach(item => {
                    if (!ordersMap.has(item.order_id)) {
                        ordersMap.set(item.order_id, {
                            id: item.order_id,
                            purchase_time: item.purchase_time,
                            items: []
                        });
                    }
                    ordersMap.get(item.order_id).items.push({
                        product_name: item.product_name,
                        quantity: item.quantity,
                        price: item.price
                    });
                });

                ordersMap.forEach(order => {
                    order.items.forEach((item, index) => {
                        let tr = document.createElement('tr');
                        if (index === 0) { // First item in the order, show order details with rowspan
                            tr.innerHTML = `
                                <td rowspan="${order.items.length}">${order.id}</td>
                                <td>${item.product_name}</td>
                                <td>${item.quantity}</td>
                                <td>$${parseFloat(item.price).toFixed(2)}</td>
                                <td rowspan="${order.items.length}">${order.purchase_time}</td>
                            `;
                        } else { // Subsequent items, only show item details
                            tr.innerHTML = `
                                <td>${item.product_name}</td>
                                <td>${item.quantity}</td>
                                <td>$${parseFloat(item.price).toFixed(2)}</td>
                            `;
                        }
                        orderTbody.appendChild(tr);
                    });
                });
                console.log(`Successfully displayed ${data.length} order items across ${ordersMap.size} orders.`);
            } else {
                noOrdersMessage.textContent = "You haven't placed any orders yet.";
                noOrdersMessage.style.display = 'block';
            }
        } else {
            // If no orders in sessionStorage, redirect back to the input form
            noOrdersMessage.textContent = "No order data found. Please verify your details.";
            noOrdersMessage.style.display = 'block';
            setTimeout(() => {
                window.location.href = 'my_orders.html';
            }, 3000); // Redirect after 3 seconds
        }
    }

    document.addEventListener('DOMContentLoaded', displayOrders);

</script>
<br>
  <footer>
  <div class="footerLeft">
      <div class="footerMenu">
          <h1 class="fMenuTitle">About Us</h1>
          <ul class="fList">
              <li class="fListItem"><strong>Opening hour</strong><br>
              every day from 8:00 AM to 9:00 PM</li>
              <li class="fListItem"><strong>Location</strong><br>
              10 Downing Street, London SW1A 1AA</li>
              <li class="fListItem"><strong>Contact number</strong><br>
              +60123456789</li>
              <li class="fListItem"><strong>Email</strong><br>
              brewbliss@gmail.com</li>
          </ul>
      </div>
<div class="footerMenu">
          <div>
        <h1 class="fMenuTitle">Text Size</h1>
              <div>
                <a class="font_1" onclick="javascript:ChangeFont('font_1');" href="javascript:void(0);">Aa</a>
                <a class="font_2" onclick="javascript:ChangeFont('font_2');" href="javascript:void(0);">Aa</a>
                <a class="font_3" onclick="javascript:ChangeFont('font_3');" href="javascript:void(0);">Aa</a>
              </div>
</div>
    </div>
  </div>
  <div class="footerRight">
      <div class="footerRightMenu">
          <h1 class="fMenuTitle">Subscribe to our channel</h1>
      </div>
      <div class="footerRightMenu">
          <h1 class="fMenuTitle">Follow Us</h1>
          <div class="fIcons">
              <img src="./images/Contact/facebook.png"  alt="facebook" class="fIcon">
              <img src="./images/Contact/instagram.png" alt="instagram" class="fIcon">
              <img src="./images/Contact/whatsapp.png" alt="whatsapp" class="fIcon">
          </div>
      </div>
      <div class="footerRightMenu">
          <span class="copyright">Â© 2025 Brew Bliss. All rights reserved.</span>
      </div>
  </div>
</footer>
</body>
</html>